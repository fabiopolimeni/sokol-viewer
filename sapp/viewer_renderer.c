#include "viewer_renderer.h"

mesh_t make_cube_mesh() {
    vertex_t vertices[] =  {
        { { -1.0, -1.0, -1.0 }, { 0.0, 0.0, -1.0 }, { 0.0, 0.0 } },
        { {  1.0, -1.0, -1.0 }, { 0.0, 0.0, -1.0 }, { 0.0, 1.0 } },
        { {  1.0,  1.0, -1.0 }, { 0.0, 0.0, -1.0 }, { 1.0, 0.0 } },
        { { -1.0,  1.0, -1.0 }, { 0.0, 0.0, -1.0 }, { 1.0, 1.0 } },

        { { -1.0, -1.0,  1.0 }, { 0.0, 0.0, 1.0 }, { 0.0, 0.0 } },
        { {  1.0, -1.0,  1.0 }, { 0.0, 0.0, 1.0 }, { 0.0, 1.0 } },
        { {  1.0,  1.0,  1.0 }, { 0.0, 0.0, 1.0 }, { 1.0, 0.0 } },
        { { -1.0,  1.0,  1.0 }, { 0.0, 0.0, 1.0 }, { 1.0, 1.0 } },

        { { -1.0, -1.0, -1.0 }, { -1.0, 0.0, 0.0 }, { 0.0, 0.0 } },
        { { -1.0,  1.0, -1.0 }, { -1.0, 0.0, 0.0 }, { 0.0, 1.0 } },
        { { -1.0,  1.0,  1.0 }, { -1.0, 0.0, 0.0 }, { 1.0, 0.0 } },
        { { -1.0, -1.0,  1.0 }, { -1.0, 0.0, 0.0 }, { 1.0, 1.0 } },

        { { 1.0, -1.0, -1.0, }, { 1.0, 0.0, 0.0 }, { 0.0, 0.0 } },
        { { 1.0,  1.0, -1.0, }, { 1.0, 0.0, 0.0 }, { 0.0, 1.0 } },
        { { 1.0,  1.0,  1.0, }, { 1.0, 0.0, 0.0 }, { 1.0, 0.0 } },
        { { 1.0, -1.0,  1.0, }, { 1.0, 0.0, 0.0 }, { 1.0, 1.0 } },

        { { -1.0, -1.0, -1.0 }, { 0.0, -1.0, 0.0 }, { 0.0, 0.0 } },
        { { -1.0, -1.0,  1.0 }, { 0.0, -1.0, 0.0 }, { 0.0, 1.0 } },
        { {  1.0, -1.0,  1.0 }, { 0.0, -1.0, 0.0 }, { 1.0, 0.0 } },
        { {  1.0, -1.0, -1.0 }, { 0.0, -1.0, 0.0 }, { 1.0, 1.0 } },

        { { -1.0,  1.0, -1.0 }, { 0.0, 1.0, 0.0 }, { 0.0, 0.0 } },
        { { -1.0,  1.0,  1.0 }, { 0.0, 1.0, 0.0 }, { 0.0, 1.0 } },
        { {  1.0,  1.0,  1.0 }, { 0.0, 1.0, 0.0 }, { 1.0, 0.0 } },
        { {  1.0,  1.0, -1.0 }, { 0.0, 1.0, 0.0 }, { 1.0, 1.0 } }
    };
    
    uint16_t indices[] = {
        0, 1, 2,  0, 2, 3,
        6, 5, 4,  7, 6, 4,
        8, 9, 10,  8, 10, 11,
        14, 13, 12,  15, 14, 12,
        16, 17, 18,  16, 18, 19,
        22, 21, 20,  23, 22, 20
    };
    
    mesh_t mesh = {
        .vbuf = sg_make_buffer(&(sg_buffer_desc){
            .size = sizeof(vertices),
            .content = vertices,
            .label = "cube-vertices"
        }),

        .ibuf = sg_make_buffer(&(sg_buffer_desc){
            .type = SG_BUFFERTYPE_INDEXBUFFER,
            .size = sizeof(indices),
            .content = indices,
            .label = "cube-indices"
        }),

        .num_elements = sizeof(indices) / sizeof(uint16_t)
    };

    return mesh;
}


void mesh_destroy(mesh_t mesh) {
    sg_destroy_buffer(mesh.vbuf);
    sg_destroy_buffer(mesh.ibuf);
    mesh.num_elements = 0;
}
